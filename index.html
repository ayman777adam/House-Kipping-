<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Luxury Cloud</title>
    
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#d97706">
    <link rel="apple-touch-icon" href="./icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Tailwind Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙÙ‚Ø·
        tailwind.config = {
            darkMode: 'class', // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† Ø¹Ø¨Ø± Ø§Ù„ÙƒÙ„Ø§Ø³
            theme: {
                extend: {
                    fontFamily: { sans: ['Tajawal', 'sans-serif'] },
                    boxShadow: {
                        'luxury': '0 4px 20px -2px rgba(0, 0, 0, 0.1)',
                        'gold': '0 4px 15px -3px rgba(217, 119, 6, 0.3)'
                    }
                }
            }
        }
    </script>

    <style>
        body { -webkit-tap-highlight-color: transparent; user-select: none; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }

        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .picker-anim { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .row-anim { animation: fadeInScale 0.3s ease-out forwards; }

        /* Error Animation */
        @keyframes pulseRed { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .error-pulse { animation: pulseRed 1.5s infinite; border-color: #ef4444 !important; background-color: #fef2f2 !important; }
        .dark .error-pulse { background-color: #450a0a !important; }

        input[type="time"]::-webkit-calendar-picker-indicator { display: none; }
        input[type="time"] { background: transparent; border: none; color: inherit; text-align: center; font-family: 'Tajawal', sans-serif; font-weight: bold; width: 60px; padding: 0; }
        input[type="time"]:focus { outline: none; background: rgba(255,255,255,0.1); border-radius: 4px; }

        @media print {
            @page { size: A4 landscape; margin: 5mm; }
            body { background-color: white !important; color: black !important; -webkit-print-color-adjust: exact; margin: 0; padding: 0; direction: rtl !important; }
            #mainApp, #loginScreen, #pickerModal, #closeOptionsModal, #teamModal, #langModal, #confirmModal, .no-print, .dev-signature-header { display: none !important; }
            #printArea { display: block !important; width: 100%; }
            table { width: 100%; border-collapse: collapse; font-size: 11px; border: 1px solid #000; }
            th, td { border: 1px solid #000; padding: 4px; text-align: center; }
            th { background-color: #eee !important; font-weight: bold; }
            .section-header { background-color: #ddd !important; font-weight: bold; font-size: 13px; }
        }
    </style>
</head>
<!-- ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù‡Ù†Ø§ Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† -->
<body class="bg-gray-50 dark:bg-slate-900 text-gray-800 dark:text-gray-100 h-[100dvh] flex flex-col overflow-hidden transition-colors duration-300">

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© -->
    <div id="loginScreen" class="fixed inset-0 z-[200] bg-slate-900 flex flex-col items-center justify-center p-6 text-white overflow-y-auto">
        
        <button onclick="app.openLangModal()" class="absolute top-6 right-6 w-10 h-10 rounded-full bg-gray-800 border border-gray-600 flex items-center justify-center text-amber-500 shadow-lg active:scale-95 transition-all">
            <i class="fas fa-globe text-xl"></i>
        </button>

        <div class="w-full max-w-md space-y-6 text-center">
            <div class="inline-block p-5 rounded-full border-2 border-amber-500/50 bg-gradient-to-b from-gray-800 to-gray-900 shadow-2xl shadow-amber-500/20">
                <i class="fas fa-crown text-4xl text-amber-500"></i>
            </div>
            <div>
                <h1 class="text-2xl font-bold mb-1 text-amber-500">ELITE CLOUD</h1>
                <p class="text-gray-400 text-xs tracking-widest uppercase" data-i18n="systemTitle">Multi-User System</p>
            </div>

            <div class="bg-gray-800/80 backdrop-blur-md p-5 rounded-2xl border border-gray-700 space-y-4 shadow-xl">
                
                <div class="space-y-1">
                    <p class="text-xs text-gray-400 text-right pr-1 font-bold" data-i18n="branchCodeLabel">ÙƒÙˆØ¯ Ø§Ù„ÙØ±Ø¹ (1 Ø£Ùˆ 2):</p>
                    <input type="tel" id="branchCode" class="w-full p-3 rounded-xl bg-gray-900 border border-gray-600 focus:border-amber-500 outline-none text-center font-bold text-2xl tracking-widest transition-all text-amber-500 placeholder-gray-700" placeholder="****" maxlength="4">
                 </div>

                <div class="h-px bg-gray-700 my-2"></div>

                <input type="text" id="loginName" class="w-full p-3 rounded-xl bg-gray-900 border border-gray-600 focus:border-amber-500 outline-none text-center font-bold text-lg transition-all placeholder-gray-600" data-i18n-placeholder="supervisorPlaceholder" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù">
                
                <div class="space-y-2">
                    <p class="text-xs text-gray-400 text-right pr-1" data-i18n="teamLabel">ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ (Ø¬Ù‡Ø§Ø²Ùƒ ÙÙ‚Ø·):</p>
                    <div class="flex gap-2">
                        <input type="text" id="workerInput" onkeydown="if(event.key === 'Enter') app.addWorker(true)" class="flex-1 p-3 rounded-xl bg-gray-900 border border-gray-600 outline-none text-sm text-center placeholder-gray-600" data-i18n-placeholder="addName" placeholder="Ø§Ø¶Ø§ÙØ© Ø§Ø³Ù…">
                        <button onclick="app.addWorker(true)" class="bg-gray-700 hover:bg-amber-500 text-white w-12 rounded-xl font-bold transition-colors"><i class="fas fa-plus"></i></button>
                    </div>
                    <div id="workersTags" class="flex flex-wrap gap-2 justify-center min-h-[30px]"></div>
                </div>
            </div>

            <!-- Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„ - ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ù„ÙˆØ§Ù† Ù‚ÙŠØ§Ø³ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¸Ù‡ÙˆØ± -->
            <button onclick="app.login()" class="w-full bg-gradient-to-r from-amber-600 to-amber-500 text-white font-bold p-4 rounded-2xl text-lg shadow-gold hover:shadow-lg transform active:scale-95 transition-all border border-amber-400/30">
                <span data-i18n="loginBtn">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</span>
            </button>
            
             <div id="loginLoader" class="hidden mt-4">
                <i class="fas fa-circle-notch fa-spin text-amber-500 text-xl"></i>
            </div>
        </div>
    </div>

    <div id="mainApp" class="hidden flex-col h-full relative">
        <header class="bg-white dark:bg-slate-800 p-4 shadow-lg z-30 flex-none rounded-b-3xl border-b dark:border-slate-700">
            <div class="dev-signature-header text-[9px] text-gray-400 dark:text-gray-500 text-center font-mono mb-2 tracking-widest uppercase">
                Connected: <span id="connStatus" class="text-green-500">Online</span>
            </div>

            <div class="flex justify-between items-center mb-1">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl flex items-center justify-center text-white shadow-gold">
                        <i class="fas fa-building"></i>
                    </div>
                    <div>
                        <h2 id="headerBranchName" class="font-bold text-lg leading-tight dark:text-amber-500">...</h2>
                        <div class="text-xs text-gray-400 font-medium">
                            <span data-i18n="supTitle">Supervisor</span>: <span id="headerName" class="text-gray-600 dark:text-gray-300 font-bold">...</span>
                        </div>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="app.openLangModal()" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-slate-700 text-amber-600 dark:text-amber-500 flex items-center justify-center hover:bg-amber-50">
                        <i class="fas fa-globe"></i>
                    </button>
                    <button onclick="app.openTeamModal()" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-slate-700 text-blue-500 flex items-center justify-center hover:bg-blue-50">
                        <i class="fas fa-users-cog"></i>
                    </button>
                    <!-- Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… -->
                    <button onclick="app.toggleTheme()" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-slate-700 text-amber-600 dark:text-amber-400 flex items-center justify-center hover:bg-amber-50 transition-colors">
                        <i id="themeIcon" class="fas fa-moon"></i>
                    </button>
                     <button onclick="app.logout()" class="w-10 h-10 rounded-full bg-red-100 dark:bg-red-900/30 text-red-500 flex items-center justify-center hover:bg-red-50">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-4 space-y-4 pb-32">
            <div id="rowsContainer" class="space-y-4"></div>
            <div id="emptyState" class="hidden flex flex-col items-center justify-center py-20 opacity-40">
                <i class="fas fa-cloud text-6xl mb-4 text-gray-400"></i>
                <p class="font-bold text-gray-500" data-i18n="readyMsg">Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„</p>
                <p class="text-xs text-gray-400 mt-2">...</p>
            </div>
        </main>

     <div class="fixed bottom-24 left-0 right-0 flex justify-center gap-4 px-6 z-[100] pointer-events-none no-print">
    <button onclick="app.addRow('checkout')" class="pointer-events-auto flex-1 bg-gradient-to-r from-red-500 to-red-600 text-white py-3 rounded-2xl shadow-lg font-bold flex items-center justify-center gap-2 transform active:scale-95 transition-all border border-red-400">
        <i class="fas fa-sign-out-alt"></i> <span data-i18n="checkout">Ù…ØºØ§Ø¯Ø±Ø©</span>
    </button>
    <button onclick="app.addRow('customer')" class="pointer-events-auto flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-2xl shadow-lg font-bold flex items-center justify-center gap-2 transform active:scale-95 transition-all border border-blue-400">
        <i class="fas fa-user-check"></i> <span data-i18n="guest">Ù†Ø²ÙŠÙ„</span>
    </button>
</div>


        <footer class="bg-white dark:bg-slate-800 p-4 border-t dark:border-slate-700 z-50 rounded-t-3xl shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
            <button onclick="app.validateAndOpenCloseModal()" class="w-full bg-gray-900 dark:bg-black text-white p-4 rounded-2xl font-bold shadow-lg flex items-center justify-center gap-3 active:scale-95 transition-all">
                <span data-i18n="closeShift">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´ÙØª (Ù…Ø³Ø­)</span>
                <i class="fas fa-arrow-left"></i>
            </button>
        </footer>
    </div>

    <!-- Modals -->
    <div id="langModal" class="fixed inset-0 z-[250] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="document.getElementById('langModal').classList.add('hidden')"></div>
        <div class="bg-white dark:bg-slate-800 w-full max-w-sm rounded-3xl p-6 relative z-10 animate-pop-in">
            <h3 class="text-xl font-bold text-center mb-6 dark:text-white" data-i18n="selectLang">Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©</h3>
            <div class="grid grid-cols-1 gap-3">
                <button onclick="app.setLanguage('ar')" class="p-4 rounded-xl bg-gray-100 dark:bg-slate-700 font-bold text-lg flex items-center justify-between dark:text-white">
                    <span>ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                    <i class="fas fa-check text-green-500 hidden" id="lang-check-ar"></i>
                </button>
                <button onclick="app.setLanguage('en')" class="p-4 rounded-xl bg-gray-100 dark:bg-slate-700 font-bold text-lg flex items-center justify-between dark:text-white">
                    <span>ğŸ‡ºğŸ‡¸ English</span>
                    <i class="fas fa-check text-green-500 hidden" id="lang-check-en"></i>
                </button>
                <button onclick="app.setLanguage('hi')" class="p-4 rounded-xl bg-gray-100 dark:bg-slate-700 font-bold text-lg flex items-center justify-between dark:text-white">
                    <span>ğŸ‡®ğŸ‡³ Hindi (Colloquial)</span>
                    <i class="fas fa-check text-green-500 hidden" id="lang-check-hi"></i>
                </button>
                <button onclick="app.setLanguage('bn')" class="p-4 rounded-xl bg-gray-100 dark:bg-slate-700 font-bold text-lg flex items-center justify-between dark:text-white">
                    <span>ğŸ‡§ğŸ‡© Bengali (Colloquial)</span>
                    <i class="fas fa-check text-green-500 hidden" id="lang-check-bn"></i>
                </button>
            </div>
            <button onclick="document.getElementById('langModal').classList.add('hidden')" class="w-full mt-4 py-3 bg-red-500 text-white rounded-xl font-bold">Close</button>
        </div>
    </div>

    <div id="teamModal" class="fixed inset-0 z-[160] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="document.getElementById('teamModal').classList.add('hidden')"></div>
        <div class="bg-gray-800 w-full max-w-sm rounded-3xl p-6 relative z-10 animate-pop-in border border-amber-500/30 text-white">
            <h3 class="text-xl font-bold text-center mb-4 text-amber-500" data-i18n="teamTitle">Ø§Ù„ÙØ±ÙŠÙ‚</h3>
            <div class="flex gap-2 mb-4">
                <input type="text" id="modalWorkerInput" onkeydown="if(event.key === 'Enter') app.addWorker(false)" class="flex-1 p-3 rounded-xl bg-gray-900 border border-gray-600 outline-none text-sm text-center" data-i18n-placeholder="addName" placeholder="Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù…">
                <button onclick="app.addWorker(false)" class="bg-amber-500 text-black w-12 rounded-xl font-bold hover:bg-amber-400"><i class="fas fa-plus"></i></button>
            </div>
            <div id="modalTeamList" class="flex flex-wrap gap-2 justify-center mb-4 min-h-[50px] max-h-[200px] overflow-y-auto"></div>
            <button onclick="document.getElementById('teamModal').classList.add('hidden')" class="w-full py-3 bg-gray-700 rounded-xl font-bold" data-i18n="closeBtn">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="pickerModal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="app.closePicker()"></div>
        <div class="absolute bottom-0 w-full bg-white dark:bg-slate-800 rounded-t-3xl p-6 picker-anim max-h-[70vh] flex flex-col">
            <div class="w-12 h-1.5 bg-gray-300 dark:bg-slate-600 rounded-full mx-auto mb-6"></div>
            <h3 id="pickerTitle" class="text-xl font-bold text-center mb-6 dark:text-amber-500">...</h3>
            <div id="pickerGrid" class="grid grid-cols-3 gap-3 overflow-y-auto p-1 hide-scroll"></div>
        </div>
    </div>

    <div id="closeOptionsModal" class="fixed inset-0 z-[150] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="document.getElementById('closeOptionsModal').classList.add('hidden')"></div>
        <div class="bg-white dark:bg-slate-800 w-full max-w-sm rounded-3xl p-6 relative z-10 animate-pop-in">
            <h3 class="text-xl font-bold text-center mb-6 dark:text-white" data-i18n="reportOptions">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>
            <div class="space-y-3">
                <button onclick="app.printPDF()" class="w-full py-4 bg-gray-100 dark:bg-slate-700 dark:text-white rounded-2xl font-bold flex items-center justify-center gap-3">
                    <i class="fas fa-print"></i> PDF
                </button>
                <button onclick="app.sendWhatsApp()" class="w-full py-4 bg-[#25D366] text-white rounded-2xl font-bold flex items-center justify-center gap-3 shadow-lg">
                    <i class="fab fa-whatsapp text-2xl"></i> WhatsApp
                </button>
                <div class="h-px bg-gray-200 dark:bg-slate-700 my-2"></div>
                <button onclick="app.finishShift()" class="w-full py-4 bg-red-500 text-white rounded-2xl font-bold flex items-center justify-center gap-3 shadow-lg">
                    <i class="fas fa-trash-alt"></i> <span data-i18n="deleteAll">Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„ÙƒÙ„)</span>
                </button>
            </div>
        </div>
    </div>

    <div id="printArea" class="hidden">
        <div class="print-meta">
            <div class="print-logo">ELITE Housekeeping</div>
            <div style="text-align: left;">
                <div>Date: <span id="pDate"></span></div>
                <div>Branch: <span id="pBranch"></span></div>
                <div>Supervisor: <span id="pName"></span></div>
            </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th rowspan="2" width="10%">Room</th>
                    <th colspan="5">Cleaning Staff</th>
                    <th colspan="2">Timing</th>
                </tr>
                <tr>
                    <th width="12%">Living</th>
                    <th width="12%">Kitchen</th>
                    <th width="12%">Bath</th>
                    <th width="12%">Bed 1</th>
                    <th width="12%">Bed 2</th>
                    <th width="10%">Start</th>
                    <th width="10%">End</th>
                </tr>
            </thead>
            <tbody id="printBody"></tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, updateDoc, doc, deleteDoc, orderBy, serverTimestamp, writeBatch, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCcyDoYCN4jBrJOxoGRpVTxUczy4qF5yrI",
            authDomain: "house-kipping.firebaseapp.com",
            projectId: "house-kipping",
            storageBucket: "house-kipping.firebasestorage.app",
            messagingSenderId: "788154594334",
            appId: "1:788154594334:web:2d297efe5b06bb4ea1ea0f"
        };

        const fbApp = initializeApp(firebaseConfig);
        const db = getFirestore(fbApp);
        
        window.dbRef = db;
        window.fb = { collection, addDoc, query, where, onSnapshot, updateDoc, doc, deleteDoc, orderBy, serverTimestamp, writeBatch, getDocs };
        
        if(window.app && window.app.onFirebaseReady) window.app.onFirebaseReady();
    </script>

    <script>
        // --- TRANSLATION DICTIONARY ---
        const translations = {
            ar: {
                systemTitle: "Ù†Ø¸Ø§Ù… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",
                branchCodeLabel: "ÙƒÙˆØ¯ Ø§Ù„ÙØ±Ø¹ (1 Ø£Ùˆ 2):",
                supervisorPlaceholder: "Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù",
                teamLabel: "ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ (Ø¬Ù‡Ø§Ø²Ùƒ ÙÙ‚Ø·):",
                addName: "Ø§Ø¶Ø§ÙØ© Ø§Ø³Ù…",
                loginBtn: "Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…",
                supTitle: "Ø§Ù„Ù…Ø´Ø±Ù",
                readyMsg: "Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„",
                checkout: "Ù…ØºØ§Ø¯Ø±Ø©",
                guest: "Ù†Ø²ÙŠÙ„",
                closeShift: "Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´ÙØª (Ù…Ø³Ø­)",
                selectLang: "Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©",
                teamTitle: "Ø§Ù„ÙØ±ÙŠÙ‚",
                closeBtn: "Ø¥ØºÙ„Ø§Ù‚",
                reportOptions: "Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±",
                deleteAll: "Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„ÙƒÙ„)",
                floor: "Ø§Ù„Ø¯ÙˆØ±",
                room: "ØºØ±ÙØ©",
                workerLabel: "Ø¹Ø§Ù…Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©",
                corniche: "ÙØ±Ø¹ Ø§Ù„ÙƒÙˆØ±Ù†ÙŠØ´",
                andalus: "ÙØ±Ø¹ Ø§Ù„Ø£Ù†Ø¯Ù„Ø³"
            },
            en: {
                systemTitle: "Multi-User System",
                branchCodeLabel: "Branch Code (1 or 2):",
                supervisorPlaceholder: "Supervisor Name",
                teamLabel: "Staff Team (Local):",
                addName: "Add Name",
                loginBtn: "Login",
                supTitle: "Supervisor",
                readyMsg: "System Ready",
                checkout: "Checkout",
                guest: "Guest",
                closeShift: "Close Shift (Clear)",
                selectLang: "Select Language",
                teamTitle: "Team",
                closeBtn: "Close",
                reportOptions: "Report Options",
                deleteAll: "Clear All Data",
                floor: "Floor",
                room: "Room",
                workerLabel: "Area Staff",
                corniche: "Corniche Branch",
                andalus: "Andalus Branch"
            },
            hi: {
                systemTitle: "à¤®à¤²à¥à¤Ÿà¥€-à¤¯à¥‚à¤œà¤° à¤¸à¤¿à¤¸à¥à¤Ÿà¤®",
                branchCodeLabel: "à¤¬à¥à¤°à¤¾à¤‚à¤š à¤•à¥‹à¤¡ (1 à¤¯à¤¾ 2):",
                supervisorPlaceholder: "à¤¸à¥à¤ªà¤°à¤µà¤¾à¤‡à¤œà¤° à¤•à¤¾ à¤¨à¤¾à¤®",
                teamLabel: "à¤Ÿà¥€à¤® (à¤¸à¤¿à¤°à¥à¤« à¤†à¤ªà¤•à¥‡ à¤«à¥‹à¤¨ à¤®à¥‡à¤‚):",
                addName: "à¤¨à¤¾à¤® à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",
                loginBtn: "à¤²à¥‰à¤—à¤¿à¤¨ à¤•à¤°à¥‡à¤‚",
                supTitle: "à¤¸à¥à¤ªà¤°à¤µà¤¾à¤‡à¤œà¤°",
                readyMsg: "à¤¸à¤¿à¤¸à¥à¤Ÿà¤® à¤¤à¥ˆà¤¯à¤¾à¤° à¤¹à¥ˆ",
                checkout: "à¤šà¥‡à¤•-à¤†à¤‰à¤Ÿ",
                guest: "à¤—à¥‡à¤¸à¥à¤Ÿ (Guest)",
                closeShift: "à¤¶à¤¿à¤«à¥à¤Ÿ à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚ (Clear)",
                selectLang: "à¤­à¤¾à¤·à¤¾ à¤šà¥à¤¨à¥‡à¤‚",
                teamTitle: "à¤Ÿà¥€à¤®",
                closeBtn: "à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚",
                reportOptions: "à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ à¤µà¤¿à¤•à¤²à¥à¤ª",
                deleteAll: "à¤¸à¤¬ à¤¡à¤¿à¤²à¥€à¤Ÿ à¤•à¤°à¥‡à¤‚",
                floor: "à¤«à¥à¤²à¥‹à¤°",
                room: "à¤°à¥‚à¤®",
                workerLabel: "à¤¸à¥à¤Ÿà¤¾à¤«",
                corniche: "à¤•à¥‹à¤°à¥à¤¨à¤¿à¤¶ à¤¬à¥à¤°à¤¾à¤‚à¤š",
                andalus: "à¤…à¤‚à¤¦à¤¾à¤²à¥à¤¸ à¤¬à¥à¤°à¤¾à¤‚à¤š"
            },
            bn: {
                systemTitle: "à¦®à¦¾à¦²à§à¦Ÿà¦¿-à¦‡à¦‰à¦œà¦¾à¦° à¦¸à¦¿à¦¸à§à¦Ÿà§‡à¦®",
                branchCodeLabel: "à¦¬à§à¦°à¦¾à¦à§à¦š à¦•à§‹à¦¡ (1 à¦¬à¦¾ 2):",
                supervisorPlaceholder: "à¦¸à§à¦ªà¦¾à¦°à¦­à¦¾à¦‡à¦œà¦¾à¦° à¦¨à¦¾à¦®",
                teamLabel: "à¦Ÿà¦¿à¦® (à¦†à¦ªà¦¨à¦¾à¦° à¦®à§‹à¦¬à¦¾à¦‡à¦²à§‡):",
                addName: "à¦¨à¦¾à¦® à¦²à¦¿à¦–à§à¦¨",
                loginBtn: "à¦²à¦—à¦‡à¦¨ à¦•à¦°à§à¦¨",
                supTitle: "à¦¸à§à¦ªà¦¾à¦°à¦­à¦¾à¦‡à¦œà¦¾à¦°",
                readyMsg: "à¦¸à¦¿à¦¸à§à¦Ÿà§‡à¦® à¦°à§‡à¦¡à¦¿",
                checkout: "à¦šà§‡à¦•-à¦†à¦‰à¦Ÿ",
                guest: "à¦—à§‡à¦¸à§à¦Ÿ (Guest)",
                closeShift: "à¦¶à¦¿à¦«à¦Ÿ à¦¶à§‡à¦· à¦•à¦°à§à¦¨",
                selectLang: "à¦­à¦¾à¦·à¦¾ à¦¨à¦¿à¦°à§à¦¬à¦¾à¦šà¦¨ à¦•à¦°à§à¦¨",
                teamTitle: "à¦Ÿà¦¿à¦®",
                closeBtn: "à¦¬à¦¨à§à¦§ à¦•à¦°à§à¦¨",
                reportOptions: "à¦°à¦¿à¦ªà§‹à¦°à§à¦Ÿ à¦…à¦ªà¦¶à¦¨",
                deleteAll: "à¦¸à¦¬ à¦¡à¦¿à¦²à¦¿à¦Ÿ à¦•à¦°à§à¦¨",
                floor: "à¦«à§à¦²à§‹à¦°",
                room: "à¦°à§à¦®",
                workerLabel: "à¦¸à§à¦Ÿà¦¾à¦«",
                corniche: "à¦•à¦°à§à¦¨à¦¿à¦¶ à¦¬à§à¦°à¦¾à¦à§à¦š",
                andalus: "à¦†à¦¨à§à¦¦à¦¾à¦²à§à¦¸ à¦¬à§à¦°à¦¾à¦à§à¦š"
            }
        };

        const roomsConfig = {
            corniche: { 1: [101,102,103,104], 2: [201,202,203,204,205,206], 3: [301,302,303,304,305,306,307,308,309,310], 4: [401,402,403,404,405,406,407,408,409,410], 5: [501,502,503,504,505,506], 6: [601,602,603,604] },
            andalus: { 1: [101,102,103,104,105,106,107,108], 2: [201,202,203,204,205,206,207,208], 3: [301,302,303,304,305,306,307,308], 4: [401,402,403,404,405,406,407,408], 5: [501,502,503,504,505,506,507,508], 6: [601,602,603,604] }
        };

        const app = {
            state: {
                branchCode: null,
                branchKey: null,
                supervisor: '',
                data: [], 
                unsubscribe: null,
                lang: 'ar'
            },
            localConfig: { theme: 'dark', teams: [], lang: 'ar' }, 
            activePicker: null,

            init() {
                const saved = localStorage.getItem('hk_elite_local');
                if(saved) {
                    this.localConfig = JSON.parse(saved);
                    if(!this.localConfig.teams) this.localConfig.teams = [];
                    this.state.lang = this.localConfig.lang || 'ar';
                }
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ…
                if(this.localConfig.theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                
                this.applyLanguage();

                const session = localStorage.getItem('hk_elite_session');
                if(session) {
                    const parsed = JSON.parse(session);
                    this.state.branchCode = parsed.code;
                    this.state.branchKey = parsed.key;
                    this.state.supervisor = parsed.name;
                    this.startAppMode();
                } else {
                    this.renderWorkerTags(true);
                }
            },

            openLangModal() {
                document.getElementById('langModal').classList.remove('hidden');
                ['ar', 'en', 'hi', 'bn'].forEach(l => {
                    document.getElementById(`lang-check-${l}`).classList.add('hidden');
                });
                document.getElementById(`lang-check-${this.state.lang}`).classList.remove('hidden');
            },

            setLanguage(code) {
                this.state.lang = code;
                this.localConfig.lang = code;
                this.saveLocal();
                this.applyLanguage();
                document.getElementById('langModal').classList.add('hidden');
            },

            applyLanguage() {
                const t = translations[this.state.lang];
                const isRTL = this.state.lang === 'ar';
                document.documentElement.setAttribute('lang', this.state.lang);
                document.documentElement.setAttribute('dir', isRTL ? 'rtl' : 'ltr');
                document.body.style.direction = isRTL ? 'rtl' : 'ltr';
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if(t[key]) el.innerText = t[key];
                });
                document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const key = el.getAttribute('data-i18n-placeholder');
                    if(t[key]) el.placeholder = t[key];
                });
                if(this.state.branchKey) {
                    const key = this.state.branchKey;
                    document.getElementById('headerBranchName').innerText = t[key];
                }
                if(this.state.data.length > 0) this.renderList();
            },

            t(key) { return translations[this.state.lang][key] || key; },

            login() {
                const code = document.getElementById('branchCode').value.trim();
                const name = document.getElementById('loginName').value.trim();

                if(!name) return alert(this.state.lang === 'ar' ? 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù' : 'Enter Supervisor Name');
                
                let bKey = '';
                if(code === '1') bKey = 'corniche';
                else if(code === '2') bKey = 'andalus';
                else return alert('Code Error / Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯');

                this.state.branchCode = code;
                this.state.branchKey = bKey;
                this.state.supervisor = name;
                
                localStorage.setItem('hk_elite_session', JSON.stringify({ code, key: bKey, name }));
                this.startAppMode();
            },

            logout() {
                if(confirm(this.state.lang === 'ar' ? 'ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ØŸ' : 'Logout?')) {
                    if(this.state.unsubscribe) this.state.unsubscribe(); 
                    localStorage.removeItem('hk_elite_session');
                    location.reload();
                }
            },

            startAppMode() {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('flex');
                
                const key = this.state.branchKey; 
                document.getElementById('headerBranchName').innerText = this.t(key);
                document.getElementById('headerName').innerText = this.state.supervisor;

                this.listenRealtime();
            },

            listenRealtime() {
                if(!window.fb) {
                    this.onFirebaseReady = () => this.listenRealtime();
                    return;
                }
                
                const q = window.fb.query(
                    window.fb.collection(window.dbRef, "rooms"),
                    window.fb.where("branch", "==", this.state.branchKey)
                );

                this.state.unsubscribe = window.fb.onSnapshot(q, (snapshot) => {
                    this.state.data = [];
                    snapshot.forEach((doc) => {
                        this.state.data.push({ id: doc.id, ...doc.data() });
                    });
                    
                    this.state.data.sort((a, b) => {
                        const t1 = a.timestamp ? a.timestamp.seconds : 0;
                        const t2 = b.timestamp ? b.timestamp.seconds : 0;
                        return t1 - t2;
                    });

                    this.renderList();
                });
            },

            renderList() {
                const container = document.getElementById('rowsContainer');
                container.innerHTML = '';
                
                if(this.state.data.length === 0) {
                    document.getElementById('emptyState').classList.remove('hidden');
                    return;
                }
                document.getElementById('emptyState').classList.add('hidden');
                
                this.state.data.forEach(item => container.appendChild(this.createLuxuryCard(item)));
            },

            createLuxuryCard(item) {
                const div = document.createElement('div');
                div.className = 'row-anim bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-luxury dark:shadow-none dark:border dark:border-slate-700 relative overflow-hidden group';
                
                const colorClass = item.section === 'checkout' ? 'bg-red-500' : 'bg-blue-500';
                div.innerHTML += `<div class="absolute top-0 right-0 w-1.5 h-full ${colorClass}"></div>`;
                div.innerHTML += `<button onclick="app.deleteRow('${item.id}')" class="absolute top-2 left-2 text-gray-300 hover:text-red-500 z-10"><i class="fas fa-times"></i></button>`;

                const floorVal = item.floor ? `${this.t('floor')} ${item.floor}` : this.t('floor');
                const roomVal = item.room || this.t('room');
                const roomActive = item.room ? 'text-gray-900 dark:text-white' : 'text-gray-400';

                const mkPickerBtn = (field, label) => {
                    const val = item[field];
                    const hasVal = !!val;
                    return `
                        <button onclick="app.openPicker('${item.id}', '${field}')" 
                            class="flex flex-col items-center justify-center p-2 rounded-xl transition-all ${hasVal ? 'bg-amber-500 text-white shadow-gold' : 'bg-gray-50 dark:bg-slate-900 text-gray-400 border border-gray-100 dark:border-slate-700'}">
                            <span class="text-[10px] font-bold uppercase opacity-80 mb-1">${label}</span>
                            <span class="font-bold text-xs truncate w-full text-center">${val || '-'}</span>
                        </button>
                    `;
                };
                
                const paddingClass = this.state.lang === 'ar' ? 'pl-6' : 'pr-6';

                div.innerHTML += `
                    <div class="flex justify-between items-start mb-4 ${paddingClass}">
                        <div class="flex gap-2">
                            <button onclick="app.openPicker('${item.id}', 'floor')" class="bg-gray-100 dark:bg-slate-900 px-3 py-2 rounded-xl text-xs font-bold text-gray-500 border dark:border-slate-700 min-w-[50px]">${floorVal}</button>
                            <button onclick="app.openPicker('${item.id}', 'room')" class="text-2xl font-black ${roomActive} flex items-center gap-2">
                                ${roomVal} <i class="fas fa-chevron-down text-xs text-amber-500 opacity-50"></i>
                            </button>
                        </div>
                        <div class="flex flex-col items-end gap-1">
                             <div id="time-start-${item.id}" class="flex items-center bg-gray-100 dark:bg-slate-900 rounded-lg p-1 border border-transparent dark:border-slate-700 transition-colors duration-300">
                                <span class="text-[10px] font-bold text-green-600 px-1">IN</span>
                                <input type="time" value="${item.start || ''}" onchange="app.updateField('${item.id}', 'start', this.value)" class="bg-transparent font-mono font-bold w-16 text-center text-xs dark:text-white focus:outline-none">
                                <button onclick="app.setNow('${item.id}', 'start')" class="w-6 h-6 bg-green-500 text-white rounded flex items-center justify-center shadow-lg active:scale-90 transition-transform"><i class="fas fa-play text-[10px]"></i></button>
                            </div>
                            <div id="time-end-${item.id}" class="flex items-center bg-gray-100 dark:bg-slate-900 rounded-lg p-1 border border-transparent dark:border-slate-700 transition-colors duration-300">
                                <span class="text-[10px] font-bold text-red-600 px-1">OUT</span>
                                <input type="time" value="${item.end || ''}" onchange="app.updateField('${item.id}', 'end', this.value)" class="bg-transparent font-mono font-bold w-16 text-center text-xs dark:text-white focus:outline-none">
                                <button onclick="app.setNow('${item.id}', 'end')" class="w-6 h-6 bg-red-500 text-white rounded flex items-center justify-center shadow-lg active:scale-90 transition-transform"><i class="fas fa-stop text-[10px]"></i></button>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-5 gap-2">
                        ${mkPickerBtn('living', 'Liv')}
                        ${mkPickerBtn('kitchen', 'Kit')}
                        ${mkPickerBtn('bath', 'Bath')}
                        ${mkPickerBtn('bed1', 'B1')}
                        ${mkPickerBtn('bed2', 'B2')}
                    </div>
                    <div class="mt-2 text-[9px] text-gray-300 text-left w-full pl-1 font-mono">
                         ${item.lastEditor || ''}
                    </div>
                `;
                return div;
            },

            async addRow(section) {
                const list = this.state.data;
                if(list.length > 0) {
                    const lastItem = list[list.length - 1];
                    if((!lastItem.start || !lastItem.room) && lastItem.lastEditor === this.state.supervisor) {
                        return alert('âš ï¸ Check previous room / Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©');
                    }
                }

                try {
                    if(!window.fb || !window.fb.serverTimestamp) throw new Error("Firebase not ready");

                    const newRow = { 
                        branch: this.state.branchKey,
                        section: section, 
                        floor: '', room: '', 
                        living: '', kitchen: '', bath: '', bed1: '', bed2: '', 
                        start: '', end: '',
                        timestamp: window.fb.serverTimestamp(),
                        lastEditor: this.state.supervisor
                    };

                    await window.fb.addDoc(window.fb.collection(window.dbRef, "rooms"), newRow);
                    setTimeout(() => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }), 100);
                } catch(e) {
                    alert('Error adding row: ' + e.message);
                }
            },

            async updateField(id, field, val) {
                try {
                    const ref = window.fb.doc(window.dbRef, "rooms", id);
                    const updateData = {};
                    updateData[field] = val;
                    if(field === 'floor') updateData['room'] = ''; 
                    updateData['lastEditor'] = this.state.supervisor; 
                    await window.fb.updateDoc(ref, updateData);
                } catch(e) {
                    console.error(e);
                }
            },

            async deleteRow(id) {
                if(confirm(this.state.lang === 'ar' ? 'Ø­Ø°ÙØŸ' : 'Delete?')) {
                     await window.fb.deleteDoc(window.fb.doc(window.dbRef, "rooms", id));
                }
            },

            setNow(id, field) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
                this.updateField(id, field, timeStr);
            },

            addWorker(isLoginScreen) {
                const inputId = isLoginScreen ? 'workerInput' : 'modalWorkerInput';
                const input = document.getElementById(inputId);
                const name = input.value.trim();
                if(name) {
                    if(!this.localConfig.teams.includes(name)) {
                        this.localConfig.teams.push(name);
                        this.saveLocal();
                        if(isLoginScreen) this.renderWorkerTags(true);
                        else this.renderModalTeam();
                    }
                    input.value = '';
                }
                input.focus();
            },
            
            removeWorker(name, isLoginScreen) {
                const idx = this.localConfig.teams.indexOf(name);
                if(idx > -1) {
                    this.localConfig.teams.splice(idx, 1);
                    this.saveLocal();
                    if(isLoginScreen) this.renderWorkerTags(true);
                    else this.renderModalTeam();
                }
            },

            renderWorkerTags(isLoginScreen) {
                if(!isLoginScreen) return;
                const container = document.getElementById('workersTags');
                container.innerHTML = this.localConfig.teams.map(w => `
                    <span class="bg-gray-700 text-white px-3 py-1 rounded-full text-xs font-bold flex items-center gap-2 border border-amber-500/30">
                        ${w} <button onclick="app.removeWorker('${w}', true)" class="text-red-400">&times;</button>
                    </span>
                `).join('');
            },

            openTeamModal() {
                this.renderModalTeam();
                document.getElementById('teamModal').classList.remove('hidden');
            },

            renderModalTeam() {
                const container = document.getElementById('modalTeamList');
                container.innerHTML = this.localConfig.teams.map(w => `
                    <span class="bg-gray-700 text-white px-3 py-2 rounded-lg text-sm font-bold flex items-center gap-2 border border-amber-500/30">
                        ${w} <button onclick="app.removeWorker('${w}', false)" class="text-red-400 hover:text-red-300 ml-1"><i class="fas fa-trash"></i></button>
                    </span>
                `).join('');
            },

            toggleTheme() {
                // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ„Ø§Ø³ ÙÙŠ HTML
                document.documentElement.classList.toggle('dark');
                
                // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                this.localConfig.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
                document.getElementById('themeIcon').className = this.localConfig.theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                
                this.saveLocal();
            },

            saveLocal() { localStorage.setItem('hk_elite_local', JSON.stringify(this.localConfig)); },

            openPicker(id, field) {
                this.activePicker = { id, field };
                const item = this.state.data.find(i => i.id === id);
                if(!item) return;

                const grid = document.getElementById('pickerGrid');
                const title = document.getElementById('pickerTitle');
                grid.innerHTML = '';
                
                let options = [];
                if(field === 'floor') {
                    title.innerText = this.t('floor');
                    options = [1,2,3,4,5,6].map(f => ({ val: f, label: `${f}` }));
                } 
                else if(field === 'room') {
                    if(!item.floor) return alert('Select Floor First');
                    title.innerText = `${this.t('room')} (Floor ${item.floor})`;
                    const rooms = roomsConfig[this.state.branchKey][item.floor] || [];
                    options = rooms.map(r => ({ val: r, label: r }));
                } 
                else {
                    title.innerText = `${this.t('workerLabel')} (${field})`;
                    options = this.localConfig.teams.map(w => ({ val: w, label: w }));
                }

                options.forEach(opt => {
                    const btn = document.createElement('button');
                    const isActive = item[field] == opt.val;
                    btn.className = `p-4 rounded-xl font-bold text-sm shadow-sm transition-all ${isActive ? 'bg-amber-500 text-white ring-2 ring-amber-300' : 'bg-gray-100 dark:bg-slate-700 dark:text-gray-200 hover:bg-gray-200'}`;
                    btn.innerText = opt.label;
                    btn.onclick = () => { this.updateField(id, field, opt.val); this.closePicker(); };
                    grid.appendChild(btn);
                });
                document.getElementById('pickerModal').classList.remove('hidden');
            },

            closePicker() {
                document.getElementById('pickerModal').classList.add('hidden');
                this.activePicker = null;
            },

            validateAndOpenCloseModal() {
                if(this.state.data.length === 0) return alert('List Empty');
                
                document.querySelectorAll('.error-pulse').forEach(el => {
                    el.classList.remove('border-red-500', 'bg-red-100', 'error-pulse');
                    el.classList.add('border-transparent');
                });

                let hasError = false;
                if(this.state.data.some(i => !i.room)) return alert('âš ï¸ Room Number Missing!');

                this.state.data.forEach(item => {
                    const startEl = document.getElementById(`time-start-${item.id}`);
                    const endEl = document.getElementById(`time-end-${item.id}`);

                    if(!item.start && startEl) {
                        startEl.classList.remove('border-transparent', 'dark:border-slate-700');
                        startEl.classList.add('error-pulse');
                        hasError = true;
                    }
                    if(!item.end && endEl) {
                        endEl.classList.remove('border-transparent', 'dark:border-slate-700');
                        endEl.classList.add('error-pulse');
                        hasError = true;
                    }
                });

                if(hasError) {
                    alert('â›” Times Missing!');
                    return;
                }
                document.getElementById('closeOptionsModal').classList.remove('hidden');
            },

            printPDF() {
                document.getElementById('pDate').innerText = new Date().toLocaleDateString('en-GB');
                document.getElementById('pBranch').innerText = this.state.branchKey === 'corniche' ? 'CORNICHE' : 'ANDALUS';
                document.getElementById('pName').innerText = this.state.supervisor;
                const tbody = document.getElementById('printBody');
                tbody.innerHTML = '';
                
                const sorted = [...this.state.data].sort((a,b) => (a.section === 'checkout' ? -1 : 1));
                let lastSection = '';
                sorted.forEach(item => {
                    if(item.section !== lastSection) {
                        const title = item.section === 'checkout' ? 'Check Out Rooms' : 'Customer Rooms';
                        tbody.innerHTML += `<tr><td colspan="8" class="section-header">${title}</td></tr>`;
                        lastSection = item.section;
                    }
                    tbody.innerHTML += `<tr><td><b>${item.room}</b></td><td>${item.living||'-'}</td><td>${item.kitchen||'-'}</td><td>${item.bath||'-'}</td><td>${item.bed1||'-'}</td><td>${item.bed2||'-'}</td><td>${item.start||''}</td><td>${item.end||''}</td></tr>`;
                });
                window.print();
            },

            sendWhatsApp() {
                let text = `*ğŸ§¹ Report - ${this.t(this.state.branchKey)}*\nğŸ‘¤ ${this.state.supervisor}\n\n`;
                ['checkout', 'customer'].forEach(sec => {
                    const items = this.state.data.filter(i => i.section === sec);
                    if(items.length > 0) {
                        text += `*${sec === 'checkout' ? 'ğŸ”´ CheckOut' : 'ğŸ”µ Guest'}*\n`;
                        items.forEach(i => {
                            text += `ğŸ”¹ *${i.room}* (${i.start||'--'} â®• ${i.end||'--'})\n   Liv:${i.living||'-'} | Kit:${i.kitchen||'-'} | Bath:${i.bath||'-'}\n`;
                        });
                        text += `\n`;
                    }
                });
                window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            },
            
            async finishShift() {
                if(confirm(this.state.lang === 'ar' ? 'Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ' : 'Clear All Data?')) {
                    const batch = window.fb.writeBatch(window.dbRef);
                    const q = window.fb.query(window.fb.collection(window.dbRef, "rooms"), window.fb.where("branch", "==", this.state.branchKey));
                    const snapshot = await window.fb.getDocs(q);
                    
                    snapshot.forEach(doc => {
                        batch.delete(doc.ref);
                    });

                    await batch.commit();
                    document.getElementById('closeOptionsModal').classList.add('hidden');
                }
            }
        };

        // --- Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¹Ø§Ù… ---
        window.app = app;

        app.init();
    </script>
    
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered!', reg))
                    .catch(err => console.log('SW Error:', err));
            });
        }
    </script>
</body>
</html>